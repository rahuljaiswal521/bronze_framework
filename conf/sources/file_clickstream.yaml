name: clickstream
source_type: file
description: "Website clickstream events landing as JSON files in cloud storage"
enabled: true
tags:
  domain: web_analytics
  source_system: clickstream
  priority: medium

extract:
  load_type: incremental
  path: ${storage_base}/landing/clickstream/
  format: json
  auto_loader: false
  format_options:
    multiLine: "false"
    inferSchema: "false"

target:
  catalog: ${catalog}
  schema: bronze
  table: clickstream_events
  partition_by:
    - _ingest_date
  table_properties:
    delta.autoOptimize.optimizeWrite: "true"
    delta.autoOptimize.autoCompact: "true"
  metadata_columns:
    - name: _ingest_timestamp
      expression: "current_timestamp()"
    - name: _ingest_date
      expression: "current_date()"
    - name: _source_system
      expression: "'clickstream'"
    - name: _source_file
      expression: "input_file_name()"
  schema_evolution:
    mode: merge
  quality:
    enabled: true
    quarantine_threshold_pct: 10.0
  cdc:
    enabled: true
    mode: scd2
    primary_keys:
      - user_id
      - session_id
      - timestamp
    exclude_columns_from_hash:
      - _ingest_timestamp
      - _ingest_date
      - _source_file
  landing:
    path: ${storage_base}/landing/clickstream/
    retention_days: 10
    cleanup_enabled: true
